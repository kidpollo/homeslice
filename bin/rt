#!/usr/bin/env ruby

require 'rubygems'
require 'open4'
require 'enumerator'

@box   = "the-mininator.local"
@watch = "~/Downloads/watch/"

def copy_to_remote(file)
  system("scp \"#{file}\" #{@box}:#{@watch}")
end

def move_to_remote(file)
  File.unlink(file) if copy_to_remote(file)
end

def enumerate(lines)
  lines.split(/\n/).enum_for(:each_with_index).map do |line, index|
    "[#{index + 1}] #{line}"
  end.join("\n")
end

def interact(command)
  Open4::popen4("ssh #{@box}") do |pid, stdin, stdout, stderr|
    stdin.puts(command)
    stdin.close
    puts enumerate(stdout.read)
  end
end


case ARGV.shift.downcase
when 'cp' then
  ARGV.each do |arg|
    copy_to_remote(arg)
  end
when 'mv' then
  ARGV.each do |arg|
    move_to_remote(arg)
  end
when 'rm' then
  # remove(ARGV.shift)
  "Not currently supported"
when 'ls' then
  interact("ls #{@watch}/*.torrent")
when 'pause'
  # rename remote torrent file to #{name}.torrent.paused
end
